$(function(){if(userOnline){$(document).on('click','a[imgdfChange]',function(){$('.img_file').click();});$(document).on('change','.img_file',function(){$('.changepdc').submit();});$('.content > .down > .newlike').each(function(index){var tthis=$('.content > .down > .newlike').eq(index);tthis.attr('tooltip-direction','top').attr('tooltip-content','Chargement');if(tthis.attr('totalikes')>0){tthis.attr('tooltip',true);}});$(document).on('submit','form[name="del_post"]',function(){var postid=$('> input[name="postid"]',$(this)).val();$('.bloc#'+ postid).slideUp(200);console.log(postid);$.post(link.action+'goldenbook_delete_post.php',{postid:postid},function(data){if(data.type=='error'){$.error.top(data,{'scroll':'top'});$('.bloc#'+ postid).slideDown(200);}else{$('.bloc#'+ postid).remove();}
$('.tooltip').remove();if($('.container > .bloc').length<1){$('.box.newComment').after('<div class="error">Aucun message Ã  afficher pour le moment</div></div>');}},'json');return false;});$(document).on('click','.content > .down > .newlike',function(){var tthis=$(this),type=(tthis.hasClass('ilike'))?'like':'dislike',postid=tthis.attr('id'),bazhtml=tthis.clone(),tthisimg=$('> img',tthis).clone();if(type=='like'){tthis.removeClass('ilike');}else{tthis.addClass('ilike');}
$.post(link.action+'goldenbook_likegestion.php',{type:type,postid:postid},function(data){if(data.type=='error'){tthis.replaceWith(bazhtml)
$.error.top(data,{'scroll':'top'});}else{tthis.html(data.message);tthisimg.prependTo(tthis);if(data.number<1){tthis.removeAttr('tooltip');$('.tooltip').remove();}else{if(!tthis.attr('tooltip')){tthis.attr('tooltip',true);}}
tthis.attr('totalikes',data.number);}},'json');});}
$(document).on('mouseover','.content > .down > .newlike',function(){var id=$(this).attr('id'),tthis=$(this),totalikes=parseInt($(this).attr('totalikes')),left;if(totalikes>0){$.get(link.action+'goldenbook_get_like.php',{id:id},function(data){if(data.type=='error'){tthis.attr('tooltip-content',data.message);}else{var users=data.users.toString().split(','),usersList='',userListHeightPlus=0;for(var i=0;i<users.length;i++){usersList+='<p>'+ users[i]+'</p>';if(i>0){userListHeightPlus=userListHeightPlus+ 14;}}
$('.tooltip').html(usersList).animate({top:(parseInt($('.tooltip').offset().top)- userListHeightPlus)+'px',left:(parseInt(tthis.offset().left)-(parseInt($('.tooltip').css('width'))/ 2) + parseInt(tthis.css('width')) / 2) + 'px'},0);}},'json');}});});